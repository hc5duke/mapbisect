!!!

%html
  %head
    %script{ :type => "text/javascript", :src => "/javascripts/jquery.min.js" }
    %script{ :type => "text/javascript", :src => "https://maps.google.com/maps/api/js?sensor=true" }
    %script{ :type => "text/javascript", :src => "/javascripts/gmaps.js" }
  %body
    %h1 Bisect Map
    #fromlatlon{ :style => "float:left;" }
      From:
      %input#origin{ :value => "32.710719, -117.167945", :size => "30" }
    #tolatlon{ :style => "float:left;" }
      To:
      %input#destin{ :value => "37.789828, -122.402072", :size => "30" }
    %div{ :style => "clear:left;" }
    %input#submit{ :value => "go!", :type => "button" }
    #map{ :style => 'width:500px;height:500px;' }
    #instructions{ :style => 'height:100px;' }
    :javascript
      var llSanDiego = [32.710719, -117.167945];
      var llSanFrancisco = [37.789828, -122.402072];
      var latCenter = (llSanDiego[0] + llSanFrancisco[0]) / 2;
      var lonCenter = (llSanDiego[1] + llSanFrancisco[1]) / 2;
      var paths = [llSanDiego];
      $(function($) {
        var map = new GMaps({
          div: '#map',
          lat: latCenter,
          lng: lonCenter,
          zoom: 6
        });
        var step = function(e) {
          paths.unshift([e.path[0].lat(), e.path[0].lng()]);
          var first = e.path[0];
          var last = e.path[e.path.length - 1];
          var path = [first, last];
          if (e.path.length > 5) {
            var mid = e.path[Math.floor(e.path.length / 3)];
            paths.unshift([mid.lat(), mid.lng()]);
            var mid2 = e.path[Math.floor(2 * e.path.length / 3)];
            paths.unshift([mid2.lat(), mid2.lng()]);
            path = [first, mid, mid2, last];
          } else if (e.path.length > 2) {
            var mid = e.path[Math.floor(e.path.length / 2)];
            paths.unshift([mid.lat(), mid.lng()]);
            path = [first, mid, last];
          }
          map.drawPolyline({
            path: path,
            strokeColor: '#131540',
            strokeOpacity: 0.6,
            strokeWeight: 6
          });
        };
        var postResults = function(result) {
          $('#instructions').text(result);
        };
        var success = function() {
          var params = {
            paths: paths,
            dist: 20,
            pop: 100000,
            start: 0.3,
            end: 0.7
          };
          $.post('/bisect', params, postResults);
        };
        $('#submit').click(function(){
          var origin = $('#origin').val().split(',');
          var destin = $('#destin').val().split(',');
          // llSanDiego = [32.710719, -117.167945];
          // llSanFrancisco = [37.789828, -122.402072];
          map.travelRoute({
            origin: origin,
            destination: destin,
            travelMode: 'driving',
            step: step,
            success: success,
          });
        });
      });

